# PentestCyprus 3.0 | d1sk_extr4ction

**Category:** Miscellaneous **Difficulty:** Medium

**Description:** Angela Moss got us an image of a disk partition from the FBI that setup shop in E-Corp. There must be some hints on talking with their main server.
nc://challenges.pentestcyprus.org:3000

https://s3.eu-central-1.amazon.com/pentestcyprus/forensics-2/d1sk_extr4ction

## Solution

Ok so the hardest part was to figure out how to mount this thing! First we run the file command and get the following output:
```
$file d1sk_extr4ction 
d1sk_extr4ction: DOS/MBR boot sector; partition 1 : ID=0xaf, start-CHS (0x0,32,33), end-CHS (0x1,70,5), startsector 2048, 18432 sectors, extended partition table (last)
```
 On a standard hard drive one sector is 512 bytes. By multiplying each sectors of the partition with its size we get: 512*2048=1048576 bytes.
```
$ mount -o loop,offset=1048576 d1sk_extr4ction /tmp/dsk/
```
The next step is to identify any interesting files inside this mounted disk which will lead us to the flag. The *notes.txt* contained a paragraph that looked like the words where scrabbled with some kind of algorithm.
```
$ cd /tmp/dsk/documents
$ cat notes.txt

OGO A fwwv lg ojalw sdd gx lzak vgof twusmkw lzw mkwj esfmsd ak fgl nwjq zwdhxmd sfv
lzw ymqk lzsl afklsddwv lzw kqklwe sjw fgl nwjq zwdhxmd.

Lg smlzwflauslw lg lzw kwjnwj A xajkl fwwv lg kwfv lzw tqlwk 0p59434550. Lzwq ksav
kgewlzafy stgml sf wfvasf sfv zae twafy dalldw.

Lzwf A oadd tw hjgehlwv oalz s fmetwj. A fwwv lg kwfv tsuc lzsl fmetwj kimsjwv.

Lzwf A oadd tw hjgehlwv oalz s kwugfv fmetwj. A fwwv lg jwlmjf lzw jwkmdl gx 2 lg lzw hgowj gx lzsl fmetwj.
```
My first thought was that it may be a substitution cipher in which each letter in the plaintext is replaced by another letter of the alphabet. Trying all the rotations on the Ceasar cipher we can decode it with a shift of 8.
```
WOW I need to write all of this down because the user manual is not very helpful and
the guys that installed the system are not very helpful.

To authenticate to the server I first need to send the bytes 0x59434550. They said
something about an endian and him being little.

Then I will be prompted with a number. I need to send back that number squared.

Then I will be prompted with a second number. I need to return the result of 2 to the power of that number.
```
By reading the instructions we could tell that we have to do 3 things when we connected the remote server
1. Send the 0x59434550 in little endian, which is the reverse of the value provided, 0x50454359 abd last converted to ASCII 0x50454359=PECY
2. Take the number we are given and squared it.
3. Raise the new number to the power of 2.
 
```
nc challenges.pentestcyprus.org 3000
PECY
36
1296
8
256
pency_3{w0w_th3_comM_iS Re4l}
```

